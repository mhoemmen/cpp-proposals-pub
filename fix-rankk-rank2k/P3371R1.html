<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="mpark/wg21" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2024-09-10" />
  <title>Fix C++26 by making the symmetric and Hermitian rank-k and rank-2k updates consistent with the BLAS</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
</style>
  <style>
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ background-color: #f6f8fa; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { } 
code span.al { color: #ff0000; } 
code span.an { } 
code span.at { } 
code span.bn { color: #9f6807; } 
code span.bu { color: #9f6807; } 
code span.cf { color: #00607c; } 
code span.ch { color: #9f6807; } 
code span.cn { } 
code span.co { color: #008000; font-style: italic; } 
code span.cv { color: #008000; font-style: italic; } 
code span.do { color: #008000; } 
code span.dt { color: #00607c; } 
code span.dv { color: #9f6807; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #9f6807; } 
code span.fu { } 
code span.im { } 
code span.in { color: #008000; } 
code span.kw { color: #00607c; } 
code span.op { color: #af1915; } 
code span.ot { } 
code span.pp { color: #6f4e37; } 
code span.re { } 
code span.sc { color: #9f6807; } 
code span.ss { color: #9f6807; } 
code span.st { color: #9f6807; } 
code span.va { } 
code span.vs { color: #9f6807; } 
code span.wa { color: #008000; font-weight: bold; } 
code.diff {color: #898887}
code.diff span.va {color: #00AA00}
code.diff span.st {color: #bf0303}
</style>
  <style type="text/css">
body {
margin: 5em;
font-family: serif;

hyphens: auto;
line-height: 1.35;
}
div.wrapper {
max-width: 60em;
margin: auto;
}
ul {
list-style-type: none;
padding-left: 2em;
margin-top: -0.2em;
margin-bottom: -0.2em;
}
a {
text-decoration: none;
color: #4183C4;
}
a.hidden_link {
text-decoration: none;
color: inherit;
}
li {
margin-top: 0.6em;
margin-bottom: 0.6em;
}
h1, h2, h3, h4 {
position: relative;
line-height: 1;
}
a.self-link {
position: absolute;
top: 0;
left: calc(-1 * (3.5rem - 26px));
width: calc(3.5rem - 26px);
height: 2em;
text-align: center;
border: none;
transition: opacity .2s;
opacity: .5;
font-family: sans-serif;
font-weight: normal;
font-size: 83%;
}
a.self-link:hover { opacity: 1; }
a.self-link::before { content: "§"; }
ul > li:before {
content: "\2014";
position: absolute;
margin-left: -1.5em;
}
:target { background-color: #C9FBC9; }
:target .codeblock { background-color: #C9FBC9; }
:target ul { background-color: #C9FBC9; }
.abbr_ref { float: right; }
.folded_abbr_ref { float: right; }
:target .folded_abbr_ref { display: none; }
:target .unfolded_abbr_ref { float: right; display: inherit; }
.unfolded_abbr_ref { display: none; }
.secnum { display: inline-block; min-width: 35pt; }
.header-section-number { display: inline-block; min-width: 35pt; }
.annexnum { display: block; }
div.sourceLinkParent {
float: right;
}
a.sourceLink {
position: absolute;
opacity: 0;
margin-left: 10pt;
}
a.sourceLink:hover {
opacity: 1;
}
a.itemDeclLink {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
opacity: 0;
}
a.itemDeclLink:hover { opacity: 1; }
span.marginalizedparent {
position: relative;
left: -5em;
}
li span.marginalizedparent { left: -7em; }
li ul > li span.marginalizedparent { left: -9em; }
li ul > li ul > li span.marginalizedparent { left: -11em; }
li ul > li ul > li ul > li span.marginalizedparent { left: -13em; }
div.footnoteNumberParent {
position: relative;
left: -4.7em;
}
a.marginalized {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
}
a.enumerated_item_num {
position: relative;
left: -3.5em;
display: inline-block;
margin-right: -3em;
text-align: right;
width: 3em;
}
div.para { margin-bottom: 0.6em; margin-top: 0.6em; text-align: justify; }
div.section { text-align: justify; }
div.sentence { display: inline; }
span.indexparent {
display: inline;
position: relative;
float: right;
right: -1em;
}
a.index {
position: absolute;
display: none;
}
a.index:before { content: "⟵"; }

a.index:target {
display: inline;
}
.indexitems {
margin-left: 2em;
text-indent: -2em;
}
div.itemdescr {
margin-left: 3em;
}
.bnf {
font-family: serif;
margin-left: 40pt;
margin-top: 0.5em;
margin-bottom: 0.5em;
}
.ncbnf {
font-family: serif;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
}
.ncsimplebnf {
font-family: serif;
font-style: italic;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
background: inherit; 
}
span.textnormal {
font-style: normal;
font-family: serif;
white-space: normal;
display: inline-block;
}
span.rlap {
display: inline-block;
width: 0px;
}
span.descr { font-style: normal; font-family: serif; }
span.grammarterm { font-style: italic; }
span.term { font-style: italic; }
span.terminal { font-family: monospace; font-style: normal; }
span.nonterminal { font-style: italic; }
span.tcode { font-family: monospace; font-style: normal; }
span.textbf { font-weight: bold; }
span.textsc { font-variant: small-caps; }
a.nontermdef { font-style: italic; font-family: serif; }
span.emph { font-style: italic; }
span.techterm { font-style: italic; }
span.mathit { font-style: italic; }
span.mathsf { font-family: sans-serif; }
span.mathrm { font-family: serif; font-style: normal; }
span.textrm { font-family: serif; }
span.textsl { font-style: italic; }
span.mathtt { font-family: monospace; font-style: normal; }
span.mbox { font-family: serif; font-style: normal; }
span.ungap { display: inline-block; width: 2pt; }
span.textit { font-style: italic; }
span.texttt { font-family: monospace; }
span.tcode_in_codeblock { font-family: monospace; font-style: normal; }
span.phantom { color: white; }

span.math { font-style: normal; }
span.mathblock {
display: block;
margin-left: auto;
margin-right: auto;
margin-top: 1.2em;
margin-bottom: 1.2em;
text-align: center;
}
span.mathalpha {
font-style: italic;
}
span.synopsis {
font-weight: bold;
margin-top: 0.5em;
display: block;
}
span.definition {
font-weight: bold;
display: block;
}
.codeblock {
margin-left: 1.2em;
line-height: 127%;
}
.outputblock {
margin-left: 1.2em;
line-height: 127%;
}
div.itemdecl {
margin-top: 2ex;
}
code.itemdeclcode {
white-space: pre;
display: block;
}
span.textsuperscript {
vertical-align: super;
font-size: smaller;
line-height: 0;
}
.footnotenum { vertical-align: super; font-size: smaller; line-height: 0; }
.footnote {
font-size: small;
margin-left: 2em;
margin-right: 2em;
margin-top: 0.6em;
margin-bottom: 0.6em;
}
div.minipage {
display: inline-block;
margin-right: 3em;
}
div.numberedTable {
text-align: center;
margin: 2em;
}
div.figure {
text-align: center;
margin: 2em;
}
table {
border: 1px solid black;
border-collapse: collapse;
margin-left: auto;
margin-right: auto;
margin-top: 0.8em;
text-align: left;
hyphens: none; 
}
td, th {
padding-left: 1em;
padding-right: 1em;
vertical-align: top;
}
td.empty {
padding: 0px;
padding-left: 1px;
}
td.left {
text-align: left;
}
td.right {
text-align: right;
}
td.center {
text-align: center;
}
td.justify {
text-align: justify;
}
td.border {
border-left: 1px solid black;
}
tr.rowsep, td.cline {
border-top: 1px solid black;
}
tr.even, tr.odd {
border-bottom: 1px solid black;
}
tr.capsep {
border-top: 3px solid black;
border-top-style: double;
}
tr.header {
border-bottom: 3px solid black;
border-bottom-style: double;
}
th {
border-bottom: 1px solid black;
}
span.centry {
font-weight: bold;
}
div.table {
display: block;
margin-left: auto;
margin-right: auto;
text-align: center;
width: 90%;
}
span.indented {
display: block;
margin-left: 2em;
margin-bottom: 1em;
margin-top: 1em;
}
ol.enumeratea { list-style-type: none; background: inherit; }
ol.enumerate { list-style-type: none; background: inherit; }

code.sourceCode > span { display: inline; }

div#refs p { padding-left: 32px; text-indent: -32px; }
</style>
  <link href="data:image/vnd.microsoft.icon;base64,AAABAAIAEBAAAAEAIABoBAAAJgAAACAgAAABACAAqBAAAI4EAAAoAAAAEAAAACAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAVoJEAN6CRADegkQAWIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wCCRAAAgkQAAIJEAACCRAAsgkQAvoJEAP+CRAD/gkQA/4JEAP+CRADAgkQALoJEAACCRAAAgkQAAP///wD///8AgkQAAIJEABSCRACSgkQA/IJEAP99PQD/dzMA/3czAP99PQD/gkQA/4JEAPyCRACUgkQAFIJEAAD///8A////AHw+AFiBQwDqgkQA/4BBAP9/PxP/uZd6/9rJtf/bybX/upd7/39AFP+AQQD/gkQA/4FDAOqAQgBc////AP///wDKklv4jlEa/3o7AP+PWC//8+3o///////////////////////z7un/kFox/35AAP+GRwD/mVYA+v///wD///8A0Zpk+NmibP+0d0T/8evj///////+/fv/1sKz/9bCs//9/fr//////+/m2/+NRwL/nloA/5xYAPj///8A////ANKaZPjRmGH/5cKh////////////k149/3UwAP91MQD/lmQ//86rhv+USg3/m1YA/5hSAP+bVgD4////AP///wDSmmT4zpJY/+/bx///////8+TV/8mLT/+TVx//gkIA/5lVAP+VTAD/x6B//7aEVv/JpH7/s39J+P///wD///8A0ppk+M6SWP/u2sf///////Pj1f/Nj1T/2KFs/8mOUv+eWhD/lEsA/8aee/+0glT/x6F7/7J8Rvj///8A////ANKaZPjRmGH/48Cf///////+/v7/2qt//82PVP/OkFX/37KJ/86siv+USg7/mVQA/5hRAP+bVgD4////AP///wDSmmT40ppk/9CVXP/69O////////7+/v/x4M//8d/P//7+/f//////9u7n/6tnJf+XUgD/nFgA+P///wD///8A0ppk+NKaZP/RmWL/1qNy//r07///////////////////////+vXw/9akdP/Wnmn/y5FY/6JfFvj///8A////ANKaZFTSmmTo0ppk/9GYYv/Ql1//5cWm//Hg0P/x4ND/5cWm/9GXYP/RmGH/0ppk/9KaZOjVnmpY////AP///wDSmmQA0ppkEtKaZI7SmmT60ppk/9CWX//OkVb/zpFW/9CWX//SmmT/0ppk/NKaZJDSmmQS0ppkAP///wD///8A0ppkANKaZADSmmQA0ppkKtKaZLrSmmT/0ppk/9KaZP/SmmT/0ppkvNKaZCrSmmQA0ppkANKaZAD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkUtKaZNzSmmTc0ppkVNKaZADSmmQA0ppkANKaZADSmmQA////AP5/AAD4HwAA4AcAAMADAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADgBwAA+B8AAP5/AAAoAAAAIAAAAEAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAyCRACMgkQA6oJEAOqCRACQgkQAEIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRABigkQA5oJEAP+CRAD/gkQA/4JEAP+CRADqgkQAZoJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAA4gkQAwoJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQAxIJEADyCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAP///wD///8A////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAWgkQAmIJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAJyCRAAYgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAdIJEAPCCRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAPSCRAB4gkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQASoJEANKCRAD/gkQA/4JEAP+CRAD/g0YA/39AAP9zLgD/bSQA/2shAP9rIQD/bSQA/3MuAP9/PwD/g0YA/4JEAP+CRAD/gkQA/4JEAP+CRADUgkQAToJEAACCRAAAgkQAAP///wD///8A////AP///wB+PwAAgkUAIoJEAKiCRAD/gkQA/4JEAP+CRAD/hEcA/4BBAP9sIwD/dTAA/5RfKv+viF7/vp56/76ee/+wiF7/lWAr/3YxAP9sIwD/f0AA/4RHAP+CRAD/gkQA/4JEAP+CRAD/gkQArIJEACaBQwAA////AP///wD///8A////AIBCAEBzNAD6f0EA/4NFAP+CRAD/gkQA/4VIAP92MwD/bSUA/6N1Tv/ezsL/////////////////////////////////38/D/6V3Uv9uJgD/dTEA/4VJAP+CRAD/gkQA/4JEAP+BQwD/fUAA/4FDAEj///8A////AP///wD///8AzJRd5qBlKf91NgD/dDUA/4JEAP+FSQD/cy4A/3YyAP/PuKP//////////////////////////////////////////////////////9K7qP94NQD/ciwA/4VJAP+CRAD/fkEA/35BAP+LSwD/mlYA6v///wD///8A////AP///wDdpnL/4qx3/8KJUv+PUhf/cTMA/3AsAP90LgD/4dK+/////////////////////////////////////////////////////////////////+TYxf91MAD/dTIA/31CAP+GRwD/llQA/6FcAP+gWwD8////AP///wD///8A////ANGZY/LSm2X/4ap3/92mcP+wdT3/byQA/8mwj////////////////////////////////////////////////////////////////////////////+LYxv9zLgP/jUoA/59bAP+hXAD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/RmWL/1p9q/9ubXv/XqXj////////////////////////////7+fD/vZyG/6BxS/+gcUr/vJuE//r37f//////////////////////3MOr/5dQBf+dVQD/nVkA/5xYAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmWP/yohJ//jo2P//////////////////////4NTG/4JDFf9lGAD/bSQA/20kAP9kGAD/fz8S/+Xb0f//////5NG9/6txN/+LOgD/m1QA/51aAP+cWAD/m1cA/5xYAP+cWADy////AP///wD///8A////ANKaZPLSmmT/0ppk/8+TWf/Unmv//v37//////////////////////+TWRr/VwsA/35AAP+ERgD/g0UA/4JGAP9lHgD/kFga/8KXX/+TRwD/jT4A/49CAP+VTQD/n10A/5xYAP+OQQD/lk4A/55cAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/y4tO/92yiP//////////////////////8NnE/8eCQP+rcTT/ez0A/3IyAP98PgD/gEMA/5FSAP+USwD/jj8A/5lUAP+JNwD/yqV2/694Mf+HNQD/jkAA/82rf/+laBj/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/LiUr/4byY///////////////////////gupX/0I5P/+Wuev/Lklz/l1sj/308AP+QSwD/ol0A/59aAP+aVQD/k0oA/8yoh///////+fXv/6pwO//Lp3v///////Pr4f+oay7y////AP///wD///8A////ANKaZPLSmmT/0ppk/8uJSv/hvJj//////////////////////+G7l//Jhkb/0ppk/96nc//fqXX/x4xO/6dkFP+QSQD/llEA/5xXAP+USgD/yaOA///////38uv/qG05/8ijdv//////8efb/6ZpLPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/zIxO/9yxh///////////////////////7dbA/8iEQf/Sm2X/0Zlj/9ScZv/eqHf/2KJv/7yAQf+XTgD/iToA/5lSAP+JNgD/yKFv/611LP+HNQD/jT8A/8qmeP+kZRT/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/Pk1n/1J5q//78+//////////////////+/fv/1aFv/8iEQv/Tm2b/0ppl/9GZY//Wn2z/1pZc/9eldf/Bl2b/kUcA/4w9AP+OQAD/lUwA/59eAP+cWQD/jT8A/5ZOAP+eXADy////AP///wD///8A////ANKaZPLSmmT/0ppk/9KZY//KiEn/8d/P///////////////////////47+f/05tm/8iCP//KiEj/yohJ/8eCP//RmGH//vfy///////n1sP/rXQ7/4k4AP+TTAD/nVoA/5xYAP+cVwD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/0ptl/8uLTf/aq37////////////////////////////+/fz/6c2y/961jv/etY7/6Myx//78+v//////////////////////3MWv/5xXD/+ORAD/mFQA/51ZAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmmT/0ppk/8mFRP/s1b//////////////////////////////////////////////////////////////////////////////+PD/0JFU/7NzMv+WUQD/kUsA/5tXAP+dWQDy////AP///wD///8A////ANKaZP/SmmT/0ppk/9KaZP/Sm2X/z5NZ/8yMT//z5NX/////////////////////////////////////////////////////////////////9Ofa/8yNUP/UmGH/36p5/8yTWv+qaSD/kksA/5ROAPz///8A////AP///wD///8A0ppk5NKaZP/SmmT/0ppk/9KaZP/TnGf/zY9T/82OUv/t1sD//////////////////////////////////////////////////////+7Yw//OkFX/zI5R/9OcZ//SmmP/26V0/9ymdf/BhUf/ol8R6P///wD///8A////AP///wDSmmQ80ppk9tKaZP/SmmT/0ppk/9KaZP/TnGj/zpFW/8qJSv/dson/8uHS//////////////////////////////////Lj0//etIv/y4lL/86QVf/TnGj/0ppk/9KaZP/RmWP/05xn/9ymdfjUnWdC////AP///wD///8A////ANKaZADSmmQc0ppkotKaZP/SmmT/0ppk/9KaZP/Tm2b/0Zli/8qJSf/NjlH/16Z3/+G8mP/myKr/5siq/+G8mP/Xp3f/zY5S/8qISf/RmGH/05tm/9KaZP/SmmT/0ppk/9KaZP/SmmSm0pljINWdaQD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkQtKaZMrSmmT/0ppk/9KaZP/SmmT/0ptl/9GYYf/Nj1P/y4lL/8qISP/KiEj/y4lK/82PU//RmGH/0ptl/9KaZP/SmmT/0ppk/9KaZP/SmmTO0ppkRtKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZGzSmmTu0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmTw0ppkcNKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZBLSmmSQ0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppklNKaZBTSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQy0ppkutKaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppkvtKaZDbSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkXNKaZODSmmT/0ppk/9KaZP/SmmT/0ppk5NKaZGDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkBtKaZIbSmmTo0ppk6tKaZIrSmmQK0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP/8P///+B///+AH//+AAf//AAD//AAAP/AAAA/gAAAHwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA+AAAAfwAAAP/AAAP/8AAP//gAH//+AH///4H////D//" rel="icon" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
</head>
<body>
<div class="wrapper">
<header id="title-block-header">
<h1 class="title" style="text-align:center">Fix C++26 by making the
symmetric and Hermitian rank-k and rank-2k updates consistent with the
BLAS</h1>

<table style="border:none;float:right">
  <tr>
    <td>Document #: </td>
    <td>P3371R1</td>
  </tr>
  <tr>
    <td>Date: </td>
    <td>2024-09-10</td>
  </tr>
  <tr>
    <td style="vertical-align:top">Project: </td>
    <td>Programming Language C++<br>
      LEWG<br>
    </td>
  </tr>
  <tr>
    <td style="vertical-align:top">Reply-to: </td>
    <td>
      Mark Hoemmen<br>&lt;<a href="mailto:mhoemmen@nvidia.com" class="email">mhoemmen@nvidia.com</a>&gt;<br>
      Ilya Burylov<br>&lt;<a href="mailto:burylov@gmail.com" class="email">burylov@gmail.com</a>&gt;<br>
    </td>
  </tr>
</table>

</header>
<div style="clear:both">
<div id="TOC" role="doc-toc">
<h1 id="toctitle">Contents</h1>
<ul>
<li><a href="#authors" id="toc-authors"><span class="toc-section-number">1</span> Authors</a></li>
<li><a href="#revision-history" id="toc-revision-history"><span class="toc-section-number">2</span> Revision history</a></li>
<li><a href="#abstract" id="toc-abstract"><span class="toc-section-number">3</span> Abstract</a></li>
<li><a href="#discussion-and-proposed-changes" id="toc-discussion-and-proposed-changes"><span class="toc-section-number">4</span> Discussion and proposed changes</a>
<ul>
<li><a href="#support-both-overwriting-and-updating-rank-k-and-rank-2k-updates" id="toc-support-both-overwriting-and-updating-rank-k-and-rank-2k-updates"><span class="toc-section-number">4.1</span> Support both overwriting and
updating rank-k and rank-2k updates</a>
<ul>
<li><a href="#blas-supports-scaling-factor-beta-stdlinalg-currently-does-not" id="toc-blas-supports-scaling-factor-beta-stdlinalg-currently-does-not"><span class="toc-section-number">4.1.1</span> BLAS supports scaling factor
beta; std::linalg currently does not</a></li>
<li><a href="#inconsistency-with-general-matrix-product" id="toc-inconsistency-with-general-matrix-product"><span class="toc-section-number">4.1.2</span> Inconsistency with general
matrix product</a></li>
<li><a href="#fix-requires-changing-behavior-of-existing-overloads" id="toc-fix-requires-changing-behavior-of-existing-overloads"><span class="toc-section-number">4.1.3</span> Fix requires changing behavior
of existing overloads</a></li>
<li><a href="#add-new-updating-overloads-make-existing-ones-overwriting" id="toc-add-new-updating-overloads-make-existing-ones-overwriting"><span class="toc-section-number">4.1.4</span> Add new updating overloads; make
existing ones overwriting</a></li>
<li><a href="#do-not-apply-this-fix-to-rank-1-or-rank-2-update-functions" id="toc-do-not-apply-this-fix-to-rank-1-or-rank-2-update-functions"><span class="toc-section-number">4.1.5</span> Do not apply this fix to rank-1
or rank-2 update functions</a></li>
</ul></li>
<li><a href="#constrain-alpha-in-hermitian-rank-1-and-rank-k-updates-to-be-noncomplex" id="toc-constrain-alpha-in-hermitian-rank-1-and-rank-k-updates-to-be-noncomplex"><span class="toc-section-number">4.2</span> Constrain alpha in Hermitian
rank-1 and rank-k updates to be noncomplex</a>
<ul>
<li><a href="#scaling-factor-alpha-needs-to-be-noncomplex-else-update-may-be-non-hermitian" id="toc-scaling-factor-alpha-needs-to-be-noncomplex-else-update-may-be-non-hermitian"><span class="toc-section-number">4.2.1</span> Scaling factor alpha needs to be
noncomplex, else update may be non-Hermitian</a></li>
<li><a href="#nothing-wrong-with-rank-2-or-rank-2k-updates" id="toc-nothing-wrong-with-rank-2-or-rank-2k-updates"><span class="toc-section-number">4.2.2</span> Nothing wrong with rank-2 or
rank-2k updates</a></li>
<li><a href="#nothing-wrong-with-scaling-factor-beta" id="toc-nothing-wrong-with-scaling-factor-beta"><span class="toc-section-number">4.2.3</span> Nothing wrong with scaling
factor beta</a></li>
<li><a href="#nothing-wrong-with-hermitian-matrix-vector-and-matrix-matrix-products" id="toc-nothing-wrong-with-hermitian-matrix-vector-and-matrix-matrix-products"><span class="toc-section-number">4.2.4</span> Nothing wrong with Hermitian
matrix-vector and matrix-matrix products</a></li>
</ul></li>
<li><a href="#triangular-matrices-unit-diagonals-and-scaling-factors" id="toc-triangular-matrices-unit-diagonals-and-scaling-factors"><span class="toc-section-number">4.3</span> Triangular matrices, unit
diagonals, and scaling factors</a>
<ul>
<li><a href="#blas-applies-alpha-after-unit-diagonal-linalg-applies-it-before" id="toc-blas-applies-alpha-after-unit-diagonal-linalg-applies-it-before"><span class="toc-section-number">4.3.1</span> BLAS applies alpha after unit
diagonal; linalg applies it before</a></li>
<li><a href="#triangular-solve-algorithms-not-affected" id="toc-triangular-solve-algorithms-not-affected"><span class="toc-section-number">4.3.2</span> Triangular solve algorithms not
affected</a></li>
<li><a href="#triangular-matrix-vector-product-work-around" id="toc-triangular-matrix-vector-product-work-around"><span class="toc-section-number">4.3.3</span> Triangular matrix-vector product
work-around</a></li>
<li><a href="#triangular-matrix-matrix-product-example" id="toc-triangular-matrix-matrix-product-example"><span class="toc-section-number">4.3.4</span> Triangular matrix-matrix product
example</a></li>
<li><a href="#lapack-never-calls-xtrmm-with-the-implicit-unit-diagonal-option-and-alpha-not-equal-to-one" id="toc-lapack-never-calls-xtrmm-with-the-implicit-unit-diagonal-option-and-alpha-not-equal-to-one"><span class="toc-section-number">4.3.5</span> LAPACK never calls
<code>xTRMM</code> with the implicit unit diagonal option and
<code>alpha</code> not equal to one</a></li>
<li><a href="#fixes-would-not-break-backwards-compatibility" id="toc-fixes-would-not-break-backwards-compatibility"><span class="toc-section-number">4.3.6</span> Fixes would not break backwards
compatibility</a></li>
</ul></li>
</ul></li>
<li><a href="#ordering-with-respect-to-other-proposals-and-lwg-issues" id="toc-ordering-with-respect-to-other-proposals-and-lwg-issues"><span class="toc-section-number">5</span> Ordering with respect to other
proposals and LWG issues</a></li>
<li><a href="#acknowledgments" id="toc-acknowledgments"><span class="toc-section-number">6</span> Acknowledgments</a></li>
<li><a href="#wording" id="toc-wording"><span class="toc-section-number">7</span> Wording</a>
<ul>
<li><a href="#describe-how-functions-access-e" id="toc-describe-how-functions-access-e"><span class="toc-section-number">7.1</span> Describe how functions access
E</a></li>
<li><a href="#new-exposition-only-concept-for-possibly-packed-output-matrices" id="toc-new-exposition-only-concept-for-possibly-packed-output-matrices"><span class="toc-section-number">7.2</span> New exposition-only concept for
possibly-packed output matrices</a></li>
<li><a href="#new-exposition-only-concept-for-noncomplex-numbers" id="toc-new-exposition-only-concept-for-noncomplex-numbers"><span class="toc-section-number">7.3</span> New exposition-only concept for
noncomplex numbers</a></li>
<li><a href="#constrain-scalar-alpha-in-hermitian-rank-1-and-rank-k-updates" id="toc-constrain-scalar-alpha-in-hermitian-rank-1-and-rank-k-updates"><span class="toc-section-number">7.4</span> Constrain Scalar alpha in
Hermitian rank-1 and rank-k updates</a></li>
<li><a href="#rank-k-update-functions-in-synopsis" id="toc-rank-k-update-functions-in-synopsis"><span class="toc-section-number">7.5</span> Rank-k update functions in
synopsis</a></li>
<li><a href="#rank-2k-update-functions-in-synopsis" id="toc-rank-2k-update-functions-in-synopsis"><span class="toc-section-number">7.6</span> Rank-2k update functions in
synopsis</a></li>
<li><a href="#specification-of-rank-k-update-functions" id="toc-specification-of-rank-k-update-functions"><span class="toc-section-number">7.7</span> Specification of rank-k update
functions</a></li>
<li><a href="#specification-of-rank-2k-update-functions" id="toc-specification-of-rank-2k-update-functions"><span class="toc-section-number">7.8</span> Specification of rank-2k update
functions</a></li>
</ul></li>
</ul>
</div>
<h1 data-number="1" id="authors"><span class="header-section-number">1</span> Authors<a href="#authors" class="self-link"></a></h1>
<ul>
<li>Mark Hoemmen (mhoemmen@nvidia.com) (NVIDIA)</li>
<li>Ilya Burylov (burylov@gmail.com) (NVIDIA)</li>
</ul>
<h1 data-number="2" id="revision-history"><span class="header-section-number">2</span> Revision history<a href="#revision-history" class="self-link"></a></h1>
<ul>
<li><p>Revision 0 to be submitted 2024-08-15</p></li>
<li><p>Revision 1 to be submitted 2024-09-15</p>
<ul>
<li><p>Add Ilya Burylov as coauthor</p></li>
<li><p>Change title from “Fix C++26 by making the symmetric and
Hermitian rank-k and rank-2k updates consistent with the BLAS,” to “Fix
C++26 by making the symmetric and Hermitian rank-1, rank-k, and rank-2k
updates consistent with the BLAS.” Change abstract to list the newly
proposed rank-1 update change (constrain <code>Scalar</code> to be
noncomplex).</p></li>
<li><p>Reorganize and expand nonwording sections</p></li>
<li><p>Add “<code>C</code> may alias <code>E</code>” to all the new
updating overloads of the symmetric and Hermitian rank-k and rank-2k
functions</p></li>
<li><p>Specify that the functions access the new <code>E</code>
parameter in the same way as the <code>C</code> parameter</p></li>
<li><p>Add exposition-only concept <em><code>noncomplex</code></em> to
constrain a scaling factor to be noncomplex, as needed for Hermitian
rank-1 and rank-k functions</p></li>
<li><p>Add nonwording section explaining why we don’t change
<code>triangular_matrix_product</code></p></li>
</ul></li>
</ul>
<h1 data-number="3" id="abstract"><span class="header-section-number">3</span> Abstract<a href="#abstract" class="self-link"></a></h1>
<p>The [linalg] functions <code>hermitian_rank_1_update</code>,
<code>symmetric_matrix_rank_k_update</code>,
<code>hermitian_matrix_rank_k_update</code>,
<code>symmetric_matrix_rank_2k_update</code>, and
<code>hermitian_matrix_rank_2k_update</code> currently have behavior
inconsistent with their corresponding BLAS (Basic Linear Algebra
Subroutines) routines. (<code>symmetric_rank_1_update</code>,
<code>hermitian_rank_2_update</code>, and
<code>symmetric_rank_2_update</code> are fine.) Also, the behavior of
the rank-k and rank-2k updates is inconsistent with that of
<code>matrix_product</code>, even though in mathematical terms they are
special cases of a matrix-matrix product. We propose three fixes.</p>
<ol type="1">
<li><p>Add “updating” overloads to the symmetric and Hermitian rank-k
and rank-2k update functions. The new overloads are analogous to the
updating overloads of <code>matrix_product</code>. For example,
<code>symmetric_matrix_rank_k_update(A, scaled(beta, C), C, upper_triangle)</code>
will perform <span class="math inline"><em>C</em> := <em>β</em><em>C</em> + <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p></li>
<li><p>Change the behavior of the existing symmetric and Hermitian
rank-k and rank-2k update functions to be “overwriting.” For example,
<code>symmetric_matrix_rank_k_update(A, C, upper_triangle)</code> will
perform <span class="math inline"><em>C</em> := <em>A</em><em>A</em><sup><em>T</em></sup></span>
instead of <span class="math inline"><em>C</em> := <em>C</em> + <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p></li>
<li><p>For <code>hermitian_rank_1_update</code> and
<code>hermitian_rank_k_update</code>, we constrain the
<code>Scalar</code> template parameter (if any) to be noncomplex. This
ensures that the update will be mathematically Hermitian.</p></li>
</ol>
<p>Items (2) and (3) are breaking changes to the current Working Draft.
Thus, we must finish this before finalization of C++26.</p>
<h1 data-number="4" id="discussion-and-proposed-changes"><span class="header-section-number">4</span> Discussion and proposed changes<a href="#discussion-and-proposed-changes" class="self-link"></a></h1>
<h2 data-number="4.1" id="support-both-overwriting-and-updating-rank-k-and-rank-2k-updates"><span class="header-section-number">4.1</span> Support both overwriting and
updating rank-k and rank-2k updates<a href="#support-both-overwriting-and-updating-rank-k-and-rank-2k-updates" class="self-link"></a></h2>
<h3 data-number="4.1.1" id="blas-supports-scaling-factor-beta-stdlinalg-currently-does-not"><span class="header-section-number">4.1.1</span> BLAS supports scaling factor
beta; std::linalg currently does not<a href="#blas-supports-scaling-factor-beta-stdlinalg-currently-does-not" class="self-link"></a></h3>
<p>Each function in std::linalg generally corresponds to one or more
routines or functions in the original BLAS (Basic Linear Algebra
Subroutines). Every computation that the BLAS can do, a function in
std::linalg should be able to do.</p>
<p>One <code>std::linalg</code> user
<a href="https://github.com/kokkos/stdBLAS/issues/272#issuecomment-2248273146">reported</a>
an exception to this rule. The BLAS routine <code>DSYRK</code>
(Double-precision SYmmetric Rank-K update) computes <span class="math inline"><em>C</em> := <em>β</em><em>C</em> + <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span>,
but the corresponding <code>std::linalg</code> function
<code>symmetric_matrix_rank_k_update</code> only computes <span class="math inline"><em>C</em> := <em>C</em> + <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span>.
That is, <code>std::linalg</code> currently has no way to express this
BLAS operation with a general <span class="math inline"><em>β</em></span> scaling factor. This issue applies
to all of the symmetric and Hermitian rank-k and rank-2k update
functions.</p>
<ul>
<li><code>symmetric_matrix_rank_k_update</code>: computes <span class="math inline"><em>C</em> := <em>C</em> + <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span></li>
<li><code>hermitian_matrix_rank_k_update</code>: computes <span class="math inline"><em>C</em> := <em>C</em> + <em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span></li>
<li><code>symmetric_matrix_rank_2k_update</code>: computes <span class="math inline"><em>C</em> := <em>C</em> + <em>α</em><em>A</em><em>B</em><sup><em>H</em></sup> + <em>α</em><em>B</em><em>A</em><sup><em>H</em></sup></span></li>
<li><code>hermitian_matrix_rank_2k_update</code>: computes <span class="math inline"><em>C</em> := <em>C</em> + <em>α</em><em>A</em><em>B</em><sup><em>H</em></sup> + <em>ᾱ</em><em>B</em><em>A</em><sup><em>H</em></sup></span>,
where <span class="math inline"><em>ᾱ</em></span> denotes the complex
conjugate of <span class="math inline"><em>α</em></span></li>
</ul>
<h3 data-number="4.1.2" id="inconsistency-with-general-matrix-product"><span class="header-section-number">4.1.2</span> Inconsistency with general
matrix product<a href="#inconsistency-with-general-matrix-product" class="self-link"></a></h3>
<p>These functions implement special cases of matrix-matrix products.
The <code>matrix_product</code> function in <code>std::linalg</code>
implements the general case of matrix-matrix products. This function
corresponds to the BLAS’s <code>SGEMM</code>, <code>DGEMM</code>,
<code>CGEMM</code>, and <code>ZGEMM</code>, which compute <span class="math inline"><em>C</em> := <em>β</em><em>C</em> + <em>α</em><em>A</em><em>B</em></span>,
where <span class="math inline"><em>α</em></span> and <span class="math inline"><em>β</em></span> are scaling factors. The
<code>matrix_product</code> function has two kinds of overloads:</p>
<ol type="1">
<li><p><em>overwriting</em> (<span class="math inline"><em>C</em> = <em>A</em><em>B</em></span>)
and</p></li>
<li><p><em>updating</em> (<span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>B</em></span>).</p></li>
</ol>
<p>The updating overloads handle the general <span class="math inline"><em>α</em></span> and <span class="math inline"><em>β</em></span> case by
<code>matrix_product(scaled(alpha, A), B, scaled(beta, C), C)</code>.
The specification explicitly permits the input
<code>scaled(beta, C)</code> to alias the output <code>C</code>
(<strong>[linalg.algs.blas3.gemm]</strong> 10: “<em>Remarks</em>:
<code>C</code> may alias <code>E</code>”). The <code>std::linalg</code>
library provides overwriting and updating overloads so that it can do
everything that the BLAS does, just in a more idiomatically C++ way.
Please see
<a href="https://isocpp.org/files/papers/P1673R13.html#function-argument-aliasing-and-zero-scalar-multipliers">P1673R13
Section 10.3</a> (“Function argument aliasing and zero scalar
multipliers”) for a more detailed explanation.</p>
<h3 data-number="4.1.3" id="fix-requires-changing-behavior-of-existing-overloads"><span class="header-section-number">4.1.3</span> Fix requires changing
behavior of existing overloads<a href="#fix-requires-changing-behavior-of-existing-overloads" class="self-link"></a></h3>
<p>The problem with the current symmetric and Hermitian rank-k and
rank-2k functions is that they have the same <em>calling syntax</em> as
the overwriting version of <code>matrix_product</code>, but
<em>semantics</em> that differ from both the overwriting and the
updating versions of <code>matrix_product</code>. For example,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_rank_k_update<span class="op">(</span>alpha, A, C<span class="op">)</span>;</span></code></pre></div>
<p>updates <span class="math inline"><em>C</em></span> with <span class="math inline"><em>C</em> + <em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>,
but</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>matrix_product<span class="op">(</span>scaled<span class="op">(</span>alpha, A<span class="op">)</span>, conjugate_transposed<span class="op">(</span>A<span class="op">)</span>, C<span class="op">)</span>;</span></code></pre></div>
<p>overwrites <span class="math inline"><em>C</em></span> with <span class="math inline"><em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>.
The current rank-k and rank-2k overloads are not overwriting, so we
can’t just fix this problem by introducing an “updating” overload for
each function.</p>
<p>Incidentally, the fact that these functions have “update” in their
name is not relevant, because that naming choice is original to the
BLAS. The BLAS calls its corresponding <code>xSYRK</code>,
<code>xHERK</code>, <code>xSYR2K</code>, and <code>xHER2K</code>
routines “{Symmetric, Hermitian} rank {one, two} update,” even though
setting <span class="math inline"><em>β</em> = 0</span> makes these
routines “overwriting” in the sense of <code>std::linalg</code>.</p>
<h3 data-number="4.1.4" id="add-new-updating-overloads-make-existing-ones-overwriting"><span class="header-section-number">4.1.4</span> Add new updating overloads;
make existing ones overwriting<a href="#add-new-updating-overloads-make-existing-ones-overwriting" class="self-link"></a></h3>
<p>We propose to fix this by making the four functions work just like
<code>matrix_vector_product</code> or <code>matrix_product</code>. This
entails three changes.</p>
<ol type="1">
<li><p>Add a new exposition-only concept
<em><code>possibly-packed-out-matrix</code></em> for constraining the
output-only parameter of the new updating overloads (see (2)).</p></li>
<li><p>Add “updating” overloads of the symmetric and Hermitian rank-k
and rank-2k update functions.</p>
<ol type="a">
<li><p>The updating overloads take a new input matrix parameter
<code>E</code>, analogous to the updating overloads of
<code>matrix_product</code>, and make <code>C</code> an output parameter
instead of an in/out parameter. For example,
<code>symmetric_matrix_rank_k_update(A, E, C, upper_triangle)</code>
computes <span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p></li>
<li><p>Explicitly permit <code>C</code> and <code>E</code> to alias,
thus permitting the desired case where <code>E</code> is
<code>scaled(beta, C)</code>.</p></li>
<li><p>The updating overloads take <code>E</code> as an
<em><code>in-matrix</code></em>, and take <code>C</code> as a
<em><code>possibly-packed-out-matrix</code></em> (instead of a
<em><code>possibly-packed-inout-matrix</code></em>).</p></li>
<li><p><code>E</code> must be accessed as a symmetric or Hermitian
matrix (depending on the function name) and such accesses must use the
same triangle as <code>C</code>. (The existing [linalg.general] 4
wording for symmetric and Hermitian behavior does not cover
<code>E</code>.)</p></li>
</ol></li>
<li><p>Change the behavior of the existing symmetric and Hermitian
rank-k and rank-2k overloads to be overwriting instead of updating.</p>
<ol type="a">
<li><p>For example,
<code>symmetric_matrix_rank_k_update(A, C, upper_triangle)</code> will
compute <span class="math inline"><em>C</em> = <em>A</em><em>A</em><sup><em>T</em></sup></span>
instead of <span class="math inline"><em>C</em> := <em>C</em> + <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p></li>
<li><p>Change <code>C</code> from a
<em><code>possibly-packed-inout-matrix</code></em> to a
<em><code>possibly-packed-out-matrix</code></em>.</p></li>
</ol></li>
</ol>
<p>Items (2) and (3) are breaking changes to the current Working Draft.
This needs to be so that we can provide the overwriting behavior <span class="math inline"><em>C</em> := <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span>
or <span class="math inline"><em>C</em> := <em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>
that the corresponding BLAS routines already provide. Thus, we must
finish this before finalization of C++26.</p>
<p>Both sets of overloads still only write to the specified triangle
(lower or upper) of the output matrix <code>C</code>. As a result, the
new updating overloads only read from that triangle of the input matrix
<code>E</code>. Therefore, even though <code>E</code> may be a different
matrix than <code>C</code>, the updating overloads do not need an
additional <code>Triangle t_E</code> parameter for <code>E</code>. The
<code>symmetric_*</code> functions interpret <code>E</code> as symmetric
in the same way that they interpret <code>C</code> as symmetric, and the
<code>hermitian_*</code> functions interpret <code>E</code> as Hermitian
in the same way that they interpret <code>C</code> as Hermitian.
Nevertheless, we do need new wording to explain how the functions may
interpret and access <code>E</code>.</p>
<h3 data-number="4.1.5" id="do-not-apply-this-fix-to-rank-1-or-rank-2-update-functions"><span class="header-section-number">4.1.5</span> Do not apply this fix to
rank-1 or rank-2 update functions<a href="#do-not-apply-this-fix-to-rank-1-or-rank-2-update-functions" class="self-link"></a></h3>
<p>The rank-k and rank-2k update functions have the following rank-1 and
rank-2 analogs, where <span class="math inline"><em>A</em></span>
denotes a symmetric or Hermitian matrix (depending on the function’s
name) and <span class="math inline"><em>x</em></span> and <span class="math inline"><em>y</em></span> denote vectors.</p>
<ul>
<li><code>symmetric_matrix_rank_1_update</code>: computes <span class="math inline"><em>A</em> := <em>A</em> + <em>α</em><em>x</em><em>x</em><sup><em>T</em></sup></span></li>
<li><code>hermetian_matrix_rank_1_update</code>: computes <span class="math inline"><em>A</em> := <em>A</em> + <em>α</em><em>x</em><em>x</em><sup><em>H</em></sup></span></li>
<li><code>symmetric_matrix_rank_2_update</code>: computes <span class="math inline"><em>A</em> := <em>A</em> + <em>α</em><em>x</em><em>y</em><sup><em>T</em></sup> + <em>α</em><em>y</em><em>x</em><sup><em>T</em></sup></span></li>
<li><code>hermitian_matrix_rank_2_update</code>: computes <span class="math inline"><em>A</em> := <em>A</em> + <em>α</em><em>x</em><em>y</em><sup><em>H</em></sup> + <em>ᾱ</em><em>x</em><em>y</em><sup><em>H</em></sup></span></li>
</ul>
<p>We do NOT propose to change these functions analogously to the rank-k
and rank-2k update functions. This is because the BLAS routines
corresponding to the rank-1 and rank-2 functions – <code>xSYR</code>,
<code>xHER</code>, <code>xSYR2</code>, and <code>xHER2</code> – do not
have a way to supply a <span class="math inline"><em>β</em></span>
scaling factor. That is, these <code>std::linalg</code> functions can
already do everything that their corresponding BLAS routines can do.
This is consistent with our design intent in
<a href="https://isocpp.org/files/papers/P1673R13.html#function-argument-aliasing-and-zero-scalar-multipliers">Section
10.3 of P1673R3</a> for translating Fortran <code>INTENT(INOUT)</code>
arguments into a C++ idiom.</p>
<blockquote>
<ol start="2" type="a">
<li><p>Else, if the BLAS function unconditionally updates (like
<code>xGER</code>), we retain read-and-write behavior for that
argument.</p></li>
<li><p>Else, if the BLAS function uses a scalar <code>beta</code>
argument to decide whether to read the output argument as well as write
to it (like <code>xGEMM</code>), we provide two versions: a write-only
[that is, “overwriting”] version (as if <code>beta</code> is zero), and
a read-and-write [that is, “updating”] version (as if <code>beta</code>
is nonzero).</p></li>
</ol>
</blockquote>
<p>The rank-1 and rank-2 update functions “unconditionally update,” in
the same way that the BLAS’s general rank-1 update routine
<code>xGER</code> does. However, the BLAS’s rank-k and rank-2k update
functions “use a scalar <code>beta</code> argument…,” so for
consistency, it makes sense for <code>std::linalg</code> to provide both
overwriting and updating versions. Users who want overwriting behavior
in a rank-1 or rank-2 update can call the corresponding rank-k or
rank-2k updating function with a matrix with one column (<span class="math inline"><em>k</em> = 1</span>) instead of a vector.</p>
<p>Since we do not propose changing the symmetric and Hermitian rank-1
and rank-2 functions, we retain the exposition-only concept
<em><code>possibly-packed-inout-matrix</code></em>, which they use to
constrain their parameter <code>A</code>.</p>
<h2 data-number="4.2" id="constrain-alpha-in-hermitian-rank-1-and-rank-k-updates-to-be-noncomplex"><span class="header-section-number">4.2</span> Constrain alpha in Hermitian
rank-1 and rank-k updates to be noncomplex<a href="#constrain-alpha-in-hermitian-rank-1-and-rank-k-updates-to-be-noncomplex" class="self-link"></a></h2>
<h3 data-number="4.2.1" id="scaling-factor-alpha-needs-to-be-noncomplex-else-update-may-be-non-hermitian"><span class="header-section-number">4.2.1</span> Scaling factor alpha needs to
be noncomplex, else update may be non-Hermitian<a href="#scaling-factor-alpha-needs-to-be-noncomplex-else-update-may-be-non-hermitian" class="self-link"></a></h3>
<p>The C++ Working Draft already has <code>Scalar alpha</code> overloads
of <code>hermitian_rank_k_update</code>. The <code>Scalar</code> type
currently can be complex. However, if <code>alpha</code> has nonzero
imaginary part, then <span class="math inline"><em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>
may no longer be a Hermitian matrix, even though <span class="math inline"><em>A</em><em>A</em><sup><em>H</em></sup></span> is
mathematically always Hermitian. For example, if <span class="math inline"><em>A</em></span> is the identity matrix (with ones
on the diagonal and zeros elsewhere) and <span class="math inline"><em>α</em> = <em>i</em></span>, then <span class="math inline"><em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>
is the diagonal matrix whose diagonal elements are all <span class="math inline"><em>i</em></span>. While that matrix is symmetric,
it is not Hermitian, because all elements on the diagonal of a Hermitian
matrix must have nonzero imaginary part. The rank-1 update function
<code>hermitian_rank_1_update</code> has the analogous issue.</p>
<p>The BLAS solves this problem by having the Hermitian rank-1 update
routines <code>xHER</code> and rank-k update routines <code>xHERK</code>
take the scaling factor <span class="math inline"><em>α</em></span> as a
noncomplex number. This suggests a fix: For all
<code>hermitian_rank_1_update</code> and
<code>hermitian_rank_k_update</code> overloads that take
<code>Scalar alpha</code>, constrain <code>Scalar</code> so that it is
noncomplex. We can avoid introducing new undefined behavior (or “valid
but unspecified” elements of the output matrix) by making “noncomplex” a
constraint on the <code>Scalar</code> type of <code>alpha</code>.
“Noncomplex” should follow the definition of “noncomplex” used by
<em><code>conj-if-needed</code></em>: either an arithmetic type, or
<code>conj(E)</code> is not ADL-findable for an expression
<code>E</code> of type <code>Scalar</code>.</p>
<h3 data-number="4.2.2" id="nothing-wrong-with-rank-2-or-rank-2k-updates"><span class="header-section-number">4.2.2</span> Nothing wrong with rank-2 or
rank-2k updates<a href="#nothing-wrong-with-rank-2-or-rank-2k-updates" class="self-link"></a></h3>
<p>This issue does <em>not</em> arise with the rank-2 or rank-2k
updates. In the BLAS, the rank-2 updates <code>xHER2</code> and the
rank-2k updates <code>xHER2K</code> all take <code>alpha</code> as a
complex number. The matrix <span class="math inline"><em>α</em><em>A</em><em>B</em><sup><em>H</em></sup> + <em>ᾱ</em><em>B</em><em>A</em><sup><em>H</em></sup></span>
is Hermitian by construction, so there’s no need to impose a
precondition on the value of <span class="math inline"><em>α</em></span>.</p>
<h3 data-number="4.2.3" id="nothing-wrong-with-scaling-factor-beta"><span class="header-section-number">4.2.3</span> Nothing wrong with scaling
factor beta<a href="#nothing-wrong-with-scaling-factor-beta" class="self-link"></a></h3>
<p>The scaling factor <code>beta</code> only arises with the rank-k
update function <code>hermitian_rank_k_update</code>. The current
wording behaves correctly with respect to <code>beta</code>. For the new
updating overloads of <code>hermitian_rank_k_update</code>, [linalg]
expresses a <code>beta</code> scaling factor by letting users supply
<code>scaled(beta, C)</code> as the argument for <code>E</code>. The
current wording merely requires that <code>scaled(beta, C)</code> be
Hermitian. It is actually incorrect to constrain <code>beta</code> or
<code>C</code> separately. For example, if <span class="math inline"><em>β</em> =  − <em>i</em></span> and <span class="math inline"><em>C</em></span> is the matrix whose elements are
all <span class="math inline"><em>i</em></span>, then <span class="math inline"><em>C</em></span> is not Hermitian but <span class="math inline"><em>β</em><em>C</em></span> (and therefore
<code>scaled(beta, C)</code>) is Hermitian.</p>
<p>The current wording for <code>hermitian_rank_1_update</code> is
correct. As explained elsewhere in this proposal,
<code>hermitian_rank_1_update</code> only needs to support what
<code>xHER</code> supports, and <code>xHER</code> does not support
updates with a <code>beta</code> scaling factor.</p>
<p>This issue does <em>not</em> arise with the rank-2k updates. In the
BLAS, <code>xHER2K</code> takes <code>beta</code> as a real number. The
previous paragraph’s reasoning for <code>beta</code> applies here as
well.</p>
<p>This issue also does not arise with the rank-2 updates. In the
Reference BLAS, the rank-2 update routines <code>xHER2</code> do not
have a way to supply <code>beta</code>. As explained in P1673, [linalg]
prefers to limit itself to the functionality in the Reference BLAS, as
this is the most widely available implementation. Thus, [linalg] retains
the no-<code>beta</code> interface. Interestingly, in the BLAS Standard,
<code>xHER2</code> <em>does</em> take <code>beta</code>. The BLAS
Standard says that “<span class="math inline"><em>α</em></span> is a
complex scalar and and [sic] <span class="math inline"><em>β</em></span>
is a real scalar.” The Fortran 77 and C bindings specify the type of
<code>beta</code> as real (<code>&lt;rtype&gt;</code> resp.
<code>RSCALAR_IN</code>), but the Fortran 95 binding lists both
<code>alpha</code> and <code>beta</code> as
<code>COMPLEX(&lt;wp&gt;)</code>. The type of <code>beta</code> in the
Fortran 95 is likely a typo, considering the wording.</p>
<h3 data-number="4.2.4" id="nothing-wrong-with-hermitian-matrix-vector-and-matrix-matrix-products"><span class="header-section-number">4.2.4</span> Nothing wrong with Hermitian
matrix-vector and matrix-matrix products<a href="#nothing-wrong-with-hermitian-matrix-vector-and-matrix-matrix-products" class="self-link"></a></h3>
<p>In our view, the current behavior of
<code>hermitian_matrix_vector_product</code> and
<code>hermitian_matrix_product</code> is correct with respect to the
<code>alpha</code> scaling factor. These functions do not need extra
overloads that take <code>Scalar alpha</code>. Users who want to supply
<code>alpha</code> with nonzero imaginary part should <em>not</em> scale
the matrix <code>A</code> (as in <code>scaled(alpha, A)</code>).
Instead, they should scale the input vector <code>x</code>, as in the
following.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> alpha <span class="op">=</span> std<span class="op">::</span>complex<span class="op">{</span><span class="fl">0.0</span>, <span class="fl">1.0</span><span class="op">}</span>;</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>A, upper_triangle, scaled<span class="op">(</span>alpha, x<span class="op">)</span>, y<span class="op">)</span>;</span></code></pre></div>
<h4 data-number="4.2.4.1" id="in-blas-matrix-is-hermitian-but-scaled-matrix-need-not-be"><span class="header-section-number">4.2.4.1</span> In BLAS, matrix is
Hermitian, but scaled matrix need not be<a href="#in-blas-matrix-is-hermitian-but-scaled-matrix-need-not-be" class="self-link"></a></h4>
<p>In Chapter 2 of the BLAS Standard, both <code>xHEMV</code> and
<code>xHEMM</code> take the scaling factors <span class="math inline"><em>α</em></span> and <span class="math inline"><em>β</em></span> as complex numbers
(<code>COMPLEX&lt;wp&gt;</code>, where <code>&lt;wp&gt;</code>
represents the current working precision). The BLAS permits
<code>xHEMV</code> or <code>xHEMM</code> to be called with
<code>alpha</code> whose imaginary part is nonzero. The matrix that the
BLAS assumes to be Hermitian is <span class="math inline"><em>A</em></span>, not <span class="math inline"><em>α</em><em>A</em></span>. Even if <span class="math inline"><em>A</em></span> is Hermitian, <span class="math inline"><em>α</em><em>A</em></span> might not necessarily be
Hermitian. For example, if <span class="math inline"><em>A</em></span>
is the identity matrix (diagonal all ones) and <span class="math inline"><em>α</em></span> is <span class="math inline"><em>i</em></span>, then <span class="math inline"><em>α</em><em>A</em></span> is not Hermitian but
skew-Hermitian.</p>
<p>The current [linalg] wording requires that the input matrix be
Hermitian. This excludes using <code>scaled(alpha, A)</code> as the
input matrix, where <code>alpha</code> has nonzero imaginary part. For
example, the following gives mathematically incorrect results.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> alpha <span class="op">=</span> std<span class="op">::</span>complex<span class="op">{</span><span class="fl">0.0</span>, <span class="fl">1.0</span><span class="op">}</span>;</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>scaled<span class="op">(</span>alpha, A<span class="op">)</span>, upper_triangle, x, y<span class="op">)</span>;</span></code></pre></div>
<p>Note that the behavior of this is still well defined, at least after
applying the fix proposed in LWG4136 for diagonal elements with nonzero
imaginary part. It does not violate a precondition. Therefore, the
Standard has no way to tell the user that they did something wrong.</p>
<h4 data-number="4.2.4.2" id="status-quo-permits-scaling-via-the-input-vector"><span class="header-section-number">4.2.4.2</span> Status quo permits scaling
via the input vector<a href="#status-quo-permits-scaling-via-the-input-vector" class="self-link"></a></h4>
<p>The current wording permits introducing the scaling factor
<code>alpha</code> through the input vector.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> alpha <span class="op">=</span> std<span class="op">::</span>complex<span class="op">{</span><span class="fl">0.0</span>, <span class="fl">1.0</span><span class="op">}</span>;</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>A, upper_triangle, scaled<span class="op">(</span>alpha, x<span class="op">)</span>, y<span class="op">)</span>;</span></code></pre></div>
<p>This is fine as long as <span class="math inline"><em>α</em><em>A</em><em>x</em></span> equals <span class="math inline"><em>A</em><em>α</em><em>x</em></span>, that is, as
long as <span class="math inline"><em>α</em></span> commutes with the
elements of A. This issue would only be of concern if those
multiplications might be noncommutative. We’re already well outside the
world of “types that do ordinary arithmetic with
<code>std::complex</code>.” This scenario would only arise given a
user-defined complex type, like
<code>user_complex&lt;user_noncommutative&gt;</code> in the example
below, whose real parts have noncommutative multiplication.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> user_complex <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  user_complex<span class="op">(</span>T re, T im<span class="op">)</span> <span class="op">:</span> re_<span class="op">(</span>re<span class="op">)</span>, im_<span class="op">(</span>im<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... overloaded arithmetic operators ...</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">friend</span> T real<span class="op">(</span>user_complex<span class="op">&lt;</span>T<span class="op">&gt;</span> z<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> z<span class="op">.</span>re_; <span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">friend</span> T imag<span class="op">(</span>user_complex<span class="op">&lt;</span>T<span class="op">&gt;</span> z<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> z<span class="op">.</span>im_; <span class="op">}</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">friend</span> user_complex<span class="op">&lt;</span>T<span class="op">&gt;</span> conj<span class="op">(</span>user_complex<span class="op">&lt;</span>T<span class="op">&gt;</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">{</span>real<span class="op">(</span>z<span class="op">)</span>, <span class="op">-</span>imag<span class="op">(</span>z<span class="op">)}</span>;</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  T re_, im_;</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> alpha <span class="op">=</span> user_complex<span class="op">&lt;</span>user_noncommutative<span class="op">&gt;{</span>something, something_else<span class="op">}</span>;</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>N, upper_triangle, scaled<span class="op">(</span>alpha, x<span class="op">)</span>, y<span class="op">)</span>;</span></code></pre></div>
<p>The [linalg] library was designed to support element types with
noncommutative multiplication. On the other hand, generally, if we speak
of Hermitian matrices or even of inner products (which are used to
define Hermitian matrices), we’re working in a vector space. This means
that multiplication of the matrix’s elements is commutative. Anything
more general than that is far beyond what the BLAS can do. Thus, we
think restricting use of <code>alpha</code> with nonzero imaginary part
to <code>scaled(alpha, x)</code> is not so onerous.</p>
<h4 data-number="4.2.4.3" id="scaling-via-the-input-vector-is-weird-but-the-least-bad-choice"><span class="header-section-number">4.2.4.3</span> Scaling via the input
vector is weird, but the least bad choice<a href="#scaling-via-the-input-vector-is-weird-but-the-least-bad-choice" class="self-link"></a></h4>
<p>Many users may not like the status quo of needing to scale
<code>x</code> instead of <code>A</code>. First, it differs from the
BLAS, which puts <code>alpha</code> before <code>A</code> in its
<code>xHEMV</code> and <code>xHEMM</code> function arguments. Second,
users would get no compile-time feedback and likely no run-time feedback
if they scale <code>A</code> instead of <code>x</code>. Their code would
compile and produce correct results for almost all matrix-vector or
matrix-matrix products, <em>except</em> for the Hermitian case, and
<em>only</em> when the scaling factor has a nonzero imaginary part.
However, we still think the status quo is the least bad choice. We
explain why by discussing the following alternatives.</p>
<ol type="1">
<li><p>Treat <code>scaled(alpha, A)</code> as a special case: expect
<code>A</code> to be Hermitian and permit <code>alpha</code> to have
nonzero imaginary part</p></li>
<li><p>Forbid <code>scaled(alpha, A)</code> at compile time, so that
users must scale <code>x</code> instead</p></li>
<li><p>Add overloads that take <code>alpha</code>, analogous to the
rank-1 and rank-k update functions</p></li>
</ol>
<p>The first choice is mathematically incorrect, as we will explain
below. The second is not incorrect, but could only catch some errors.
The third is likewise not incorrect, but would add a lot of overloads
for an uncommon use case, and would still not prevent users from scaling
the matrix in mathematically incorrect ways.</p>
<h5 data-number="4.2.4.3.1" id="bad-choice-special-cases-for-scaling-the-matrix"><span class="header-section-number">4.2.4.3.1</span> Bad choice: Special cases
for scaling the matrix<a href="#bad-choice-special-cases-for-scaling-the-matrix" class="self-link"></a></h5>
<p>“Treat <code>scaled(alpha, A)</code> as a special case” actually
means three special cases, given some nested accessor type
<code>Acc</code> and a scaling factor <code>alpha</code> of type
<code>Scalar</code>.</p>
<ol type="a">
<li><p><code>scaled(alpha, A)</code>, whose accessor type is
<code>scaled_accessor&lt;Scalar, Acc&gt;</code></p></li>
<li><p><code>conjugated(scaled(alpha, A))</code>, whose accessor type is
<code>conjugated_accessor&lt;scaled_accessor&lt;Scalar, Acc&gt;&gt;</code></p></li>
<li><p><code>scaled(alpha, conjugated(A))</code>, whose accessor type is
<code>scaled_accessor&lt;Scalar, conjugated_accessor&lt;Acc&gt;&gt;</code></p></li>
</ol>
<p>One could replace <code>conjugated</code> with
<code>conjugate_transposed</code> (which we expect to be more common in
practice) without changing the accessor type.</p>
<p>This approach violates the fundamental [linalg] principle that “…
each <code>mdspan</code> parameter of a function behaves as itself and
is not otherwise ‘modified’ by other parameters” (Section 10.2.5,
P1673R13). The behavior of [linalg] is agnostic of specific accessor
types, even though implementations likely have optimizations for
specific accessor types. [linalg] takes this approach for consistency,
even where it results in different behavior from the BLAS (see Section
10.5.2 of P1673R13). The application of this principle here is “the
input parameter <code>A</code> is always Hermitian.”</p>
<p>In this case, the consistency matters for mathematical correctness.
What if <code>scaled(alpha, A)</code> is Hermitian, but <code>A</code>
itself is not? An example is <span class="math inline"><em>α</em> =  − <em>i</em></span> and <span class="math inline"><em>A</em></span> is the 2 x 2 matrix whose elements
are all <span class="math inline"><em>i</em></span>. If we treat
<code>scaled_accessor</code> as a special case, then
<code>hermitian_matrix_vector_product</code> will compute different
results.</p>
<p>Another problem is that users are permitted to define their own
accessor types, including nested accessors. Arbitrary user accessors
might have <code>scaled_accessor</code> somewhere in that nesting, or
they might have the <em>effect</em> of <code>scaled_accessor</code>
without being called that. Thus, we can’t detect all possible ways that
the matrix might be scaled.</p>
<h5 data-number="4.2.4.3.2" id="not-so-good-choice-forbid-scaling-the-matrix-at-compile-time"><span class="header-section-number">4.2.4.3.2</span> Not-so-good choice:
Forbid scaling the matrix at compile time<a href="#not-so-good-choice-forbid-scaling-the-matrix-at-compile-time" class="self-link"></a></h5>
<p>Hermitian matrix-matrix and matrix-vector product functions could
instead <em>forbid</em> scaling the matrix at compile time, at least for
the three accessor type cases listed in the previous option.</p>
<ol type="a">
<li><p><code>scaled_accessor&lt;Scalar, Acc&gt;</code></p></li>
<li><p><code>conjugated_accessor&lt;scaled_accessor&lt;Scalar, Acc&gt;&gt;</code></p></li>
<li><p><code>scaled_accessor&lt;Scalar, conjugated_accessor&lt;Acc&gt;&gt;</code></p></li>
</ol>
<p>Doing this would certainly encourage correct behavior for the most
common cases. However, as mentioned above, users are permitted to define
their own accessor types, including nested accessors. Thus, we can’t
detect all ways that an arbitrary, possibly user-defined accessor might
scale the matrix. Furthermore, scaling the matrix might still be
mathematically correct. A scaling factor with nonzero imaginary part
might even <em>make</em> the matrix Hermitian. Applying <span class="math inline"><em>i</em></span> as a scaling factor twice would
give a perfectly valid scaling factor of <span class="math inline"> − 1</span>.</p>
<h5 data-number="4.2.4.3.3" id="not-so-good-choice-add-alpha-overloads"><span class="header-section-number">4.2.4.3.3</span> Not-so-good choice: Add
alpha overloads<a href="#not-so-good-choice-add-alpha-overloads" class="self-link"></a></h5>
<p>One could imagine adding overloads that take <code>alpha</code>,
analogous to the rank-1 and rank-k update overloads that take
<code>alpha</code>. Users could then write</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>alpha, A, upper_triangle, x, y<span class="op">)</span>;</span></code></pre></div>
<p>instead of</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hermitian_matrix_vector_product<span class="op">(</span>A, upper_triangle, scaled<span class="op">(</span>alpha, x<span class="op">)</span>, y<span class="op">)</span>;</span></code></pre></div>
<p>We do not support this approach. First, it would introduce many
overloads, without adding to what the existing overloads can accomplish.
(Users can already introduce the scaling factor <code>alpha</code>
through <code>x</code>.) Contrast this with the rank-1 and rank-k
Hermitian update functions, where not having <code>alpha</code>
overloads might break simple cases. Here are two examples.</p>
<ol type="1">
<li><p>If the matrix and vector element types and the scaling factor
<span class="math inline"><em>α</em> = 2</span> are all integers, then
the update <span class="math inline"><em>C</em> := <em>C</em> − 2<em>x</em><em>x</em><sup><em>H</em></sup></span>
can be computed using integer types and arithmetic with an
<code>alpha</code> overload. However, without an <code>alpha</code>
overload, the user would need to use <code>scaled(sqrt(2), x)</code> as
the input vector, thus forcing use of floating-point arithmetic that may
give inexact results.</p></li>
<li><p>The update <span class="math inline"><em>C</em> := <em>C</em> − <em>x</em><em>x</em><sup><em>H</em></sup></span>
would require resorting to complex arithmetic, as the only way to
express <span class="math inline"> − <em>x</em><em>x</em><sup><em>H</em></sup></span>
with the same scaling factor for both vectors is <span class="math inline">(<em>i</em><em>x</em>)(<em>i</em><em>x</em>)<sup><em>H</em></sup></span>.</p></li>
</ol>
<p>Second, <code>alpha</code> overloads would not prevent users from
<em>also</em> supplying <code>scaled(gamma, A)</code> as the matrix for
some other scaling factor <code>gamma</code>. Thus, instead of solving
the problem, the overloads would introduce more possibilities for
errors.</p>
<h2 data-number="4.3" id="triangular-matrices-unit-diagonals-and-scaling-factors"><span class="header-section-number">4.3</span> Triangular matrices, unit
diagonals, and scaling factors<a href="#triangular-matrices-unit-diagonals-and-scaling-factors" class="self-link"></a></h2>
<ol type="1">
<li><p>In BLAS, triangular matrix-vector and matrix-matrix products
apply <code>alpha</code> scaling to the implicit unit diagonal. In
[linalg], the scaling factor <code>alpha</code> is not applied to the
implicit unit diagonal. This is because the library does not interpret
<code>scaled(alpha, A)</code> differently than any other
<code>mdspan</code>.</p></li>
<li><p>Users of triangular matrix-vector products can recover BLAS
functionality by scaling the input vector instead of the input matrix,
so this only matters for triangular matrix-matrix products.</p></li>
<li><p>All calls of the BLAS’s triangular matrix-matrix product routine
<code>xTRMM</code> in LAPACK (other than in testing routines) use
<code>alpha</code> equal to one.</p></li>
<li><p>Straightforward approaches for fixing this issue would not break
backwards compatibility.</p></li>
<li><p>Therefore, we do not consider fixing this a high-priority issue,
and we do not propose a fix for it in this paper.</p></li>
</ol>
<h3 data-number="4.3.1" id="blas-applies-alpha-after-unit-diagonal-linalg-applies-it-before"><span class="header-section-number">4.3.1</span> BLAS applies alpha after unit
diagonal; linalg applies it before<a href="#blas-applies-alpha-after-unit-diagonal-linalg-applies-it-before" class="self-link"></a></h3>
<p>The <code>triangular_matrix_vector_product</code> and
<code>triangular_matrix_product</code> algorithms have an
<code>implicit_unit_diagonal</code> option. This makes the algorithm not
access the diagonal of the matrix, and compute as if the diagonal were
all ones. The option corresponds to the BLAS’s “Unit” flag. BLAS
routines that take both a “Unit” flag and an <code>alpha</code> scaling
factor apply “Unit” <em>before</em> scaling by <code>alpha</code>, so
that the matrix is treated as if it has a diagonal of all
<code>alpha</code> values. In contrast, [linalg] follows the general
principle that <code>scaled(alpha, A)</code> should be treated like any
other kind of <code>mdspan</code>. As a result, algorithms interpret
<code>implicit_unit_diagonal</code> as applied to the matrix
<em>after</em> scaling by <code>alpha</code>, so that the matrix still
has a diagonal of all ones.</p>
<h3 data-number="4.3.2" id="triangular-solve-algorithms-not-affected"><span class="header-section-number">4.3.2</span> Triangular solve algorithms
not affected<a href="#triangular-solve-algorithms-not-affected" class="self-link"></a></h3>
<p>The triangular solve algorithms in [linalg] are not affected, because
their BLAS analogs either do not take an <code>alpha</code> argument (as
with <code>xTRSV</code>), or the <code>alpha</code> argument does not
affect the triangular matrix (with <code>xTRSM</code>,
<code>alpha</code> affects the right-hand sides <code>B</code>, not the
triangular matrix <code>A</code>).</p>
<h3 data-number="4.3.3" id="triangular-matrix-vector-product-work-around"><span class="header-section-number">4.3.3</span> Triangular matrix-vector
product work-around<a href="#triangular-matrix-vector-product-work-around" class="self-link"></a></h3>
<p>This issue only reduces functionality of
<code>triangular_matrix_product</code>. Users of
<code>triangular_matrix_vector_product</code> who wish to replicate the
original BLAS functionality can scale the input matrix (by supplying
<code>scaled(alpha, x)</code> instead of <code>x</code> as the input
argument) instead of the triangular matrix.</p>
<h3 data-number="4.3.4" id="triangular-matrix-matrix-product-example"><span class="header-section-number">4.3.4</span> Triangular matrix-matrix
product example<a href="#triangular-matrix-matrix-product-example" class="self-link"></a></h3>
<p>The following example computes <span class="math inline"><em>A</em> := 2<em>A</em><em>B</em></span> where
<span class="math inline"><em>A</em></span> is a lower triangular
matrix, but it makes the diagonal of <span class="math inline"><em>A</em></span> all ones on the input (right-hand)
side.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>triangular_matrix_product<span class="op">(</span>scaled<span class="op">(</span><span class="fl">2.0</span>, A<span class="op">)</span>, lower_triangle, implicit_unit_diagonal, B, A<span class="op">)</span>;</span></code></pre></div>
<p>Contrast with the analogous BLAS routine <code>DTRMM</code>, which
has the effect of making the diagonal elements all <code>2.0</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dtrmm(<span class="st">&#39;Left side&#39;</span>, <span class="st">&#39;Lower triangular&#39;</span>, <span class="st">&#39;No transpose&#39;</span>, <span class="st">&#39;Unit diagonal&#39;</span>, <span class="co">m, n, 2.0, A, lda, B, ldb)</span></span></code></pre></div>
<p>If we want to use [linalg] to express what the BLAS call expresses,
we need to perform a separate scaling.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>triangular_matrix_product<span class="op">(</span>A, lower_triangle, implicit_unit_diagonal, B, A<span class="op">)</span>;</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>scale<span class="op">(</span><span class="fl">2.0</span>, A<span class="op">)</span>;</span></code></pre></div>
<p>This is counterintuitive, and may also affect performance.
Performance of <code>scale</code> is typically bound by memory bandwidth
and/or latency, but if the work done by <code>scale</code> could be
fused with the work done by the <code>triangular_matrix_product</code>,
then <code>scale</code>’s memory operations could be “hidden” in the
cost of the matrix product.</p>
<h3 data-number="4.3.5" id="lapack-never-calls-xtrmm-with-the-implicit-unit-diagonal-option-and-alpha-not-equal-to-one"><span class="header-section-number">4.3.5</span> LAPACK never calls
<code>xTRMM</code> with the implicit unit diagonal option and
<code>alpha</code> not equal to one<a href="#lapack-never-calls-xtrmm-with-the-implicit-unit-diagonal-option-and-alpha-not-equal-to-one" class="self-link"></a></h3>
<p>How much might users care about this missing [linalg] feature?
P1673R13 explains that the BLAS was codesigned with LAPACK and that
every reference BLAS routine is used by some LAPACK routine. “The BLAS
does not aim to provide a complete set of mathematical operations. Every
function in the BLAS exists because some LINPACK or LAPACK algorithm
needs it” (Section 10.6.1). Therefore, to judge the urgency of adding
new functionality to [linalg], we can ask whether the functionality
would be needed by a C++ re-implementation of LAPACK. We think not much,
because the highest-priority target audience of the BLAS is LAPACK
developers, and LAPACK routines (other than testing routines) never use
a scaling factor alpha other than one.</p>
<p>We survey calls to <code>xTRMM</code> in the latest version of LAPACK
as of the publication date of R1 of this proposal, LAPACK 3.12.0. It
suffices to survey <code>DTRMM</code>, the double-precision real case,
since for all the routines of interest, the complex case follows the
same pattern. (We did survey <code>ZTRMM</code>, the double-precision
complex case, just in case.) LAPACK has 24 routines that call
<code>DTRMM</code> directly. They fall into five categories.</p>
<ol type="1">
<li><p>Test routines: <code>DCHK3</code>, <code>DCHKE</code>,
<code>DLARHS</code></p></li>
<li><p>Routines relating to QR factorization or using the result of a QR
factorization (especially with block Householder reflectors):
<code>DGELQT3</code>, <code>DLARFB</code>, <code>DGEQRT3</code>,
<code>DLARFB_GETT</code>, <code>DLARZB</code>,
<code>DORM22</code></p></li>
<li><p>Routines relating to computing an inverse of a triangular matrix
or of a matrix that has been factored into triangular matrices:
<code>DLAUUM</code>, <code>DTRITRI</code>, <code>DTFTRI</code>,
<code>DPFTRI</code></p></li>
<li><p>Routines relating to solving eigenvalue (or generalized
eigenvalue) problems: <code>DLAHR2</code>, <code>DSYGST</code>,
<code>DGEHRD</code>, <code>DSYGV</code>, <code>DSYGV_2STAGE</code>,
<code>DSYGVD</code>, <code>DSYGVX</code> (note that <code>DLAQR5</code>
depends on <code>DTRMM</code> via <code>EXTERNAL</code> declaration, but
doesn’t actually call it)</p></li>
<li><p>Routines relating to symmetric indefinite factorizations:
<code>DSYT01_AA</code>, <code>DSYTRI2X</code>,
<code>DSYTRI_3X</code></p></li>
</ol>
<p>The only routines that call <code>DTRMM</code> with
<code>alpha</code> equal to anything other than one or negative one are
the testing routines. Some calls in <code>DGELQT3</code> and
<code>DLARFB_GETT</code> use negative one, but these calls never specify
an implicit unit diagonal (they use the explicit diagonal option). The
only routine that might possibly call <code>DTRMM</code> with both
negative one as alpha and the implicit unit diagonal is
<code>DTFTRI</code>. (This routine “computes the inverse of a triangular
matrix A stored in RFP [Rectangular Full Packed] format.” RFP format was
introduced to LAPACK in the late 2000’s, well after the BLAS Standard
was published. See
<a href="http://www.netlib.org/lapack/lawnspdf/lawn199.pdf">LAPACK
Working Note 199</a>, which was published in 2008.) <code>DTFTRI</code>
passes its caller’s <code>diag</code> argument (which specifies either
implicit unit diagonal or explicit diagonal) to <code>DTRMM</code>. The
only two LAPACK routines that call <code>DTFTRI</code> are
<code>DERRRFP</code> (a testing routine) and <code>DPFTRI</code>.
<code>DPFTRI</code> only ever calls <code>DTFTRI</code> with
<code>diag</code> <em>not</em> specifying the implicit unit diagonal
option. Therefore, LAPACK never needs both <code>alpha</code> not equal
to one and the implicit unit diagonal option, so adding the ability to
“scale the implicit diagonal” in [linalg] is a low-priority feature.</p>
<h3 data-number="4.3.6" id="fixes-would-not-break-backwards-compatibility"><span class="header-section-number">4.3.6</span> Fixes would not break
backwards compatibility<a href="#fixes-would-not-break-backwards-compatibility" class="self-link"></a></h3>
<p>We can think of two ways to fix this issue. First, we could add an
<code>alpha</code> scaling parameter, analogous to the symmetric and
Hermitian rank-1 and rank-k update functions. Second, we could add a new
kind of <code>Diagonal</code> template parameter type that expresses a
“diagonal value.” For example, <code>implicit_diagonal_t{alpha}</code>
(or a function form, <code>implicit_diagonal(alpha)</code>) would tell
the algorithm not to access the diagonal elements, but instead to assume
that their value is <code>alpha</code>. Both of these solutions would
let users specify the diagonal’s scaling factor separately from the
scaling factor for the rest of the matrix. Those two scaling factors
could differ, which is new functionality not offered by the BLAS. More
importantly, both of these solutions could be added later, after C++26,
without breaking backwards compatibility.</p>
<h1 data-number="5" id="ordering-with-respect-to-other-proposals-and-lwg-issues"><span class="header-section-number">5</span> Ordering with respect to other
proposals and LWG issues<a href="#ordering-with-respect-to-other-proposals-and-lwg-issues" class="self-link"></a></h1>
<p>We currently have two other <code>std::linalg</code> fix papers in
review.</p>
<ul>
<li><p>P3222: Fix C++26 by adding <code>transposed</code> special cases
for P2642 layouts (forwarded by LEWG to LWG on 2024-08-27 pending
electronic poll results)</p></li>
<li><p>P3050: “Fix C++26 by optimizing <code>linalg::conjugated</code>
for noncomplex value types” (forwarded by LEWG to LWG on 2024-09-03
pending electronic poll results)</p></li>
</ul>
<p>LEWG was aware of these two papers and this pending paper P3371 in
its 2024-09-03 review of P3050R2. All three of these papers increment
the value of the <code>__cpp_lib_linalg</code> macro. While this
technically causes a conflict between the papers, advice from LEWG on
2024-09-03 was not to introduce special wording changes to avoid this
conflict.</p>
<p>We also have two outstanding LWG issues.</p>
<ul>
<li><p><a href="https://cplusplus.github.io/LWG/lwg-active.html#4136">LWG4136</a>
specifies the behavior of Hermitian algorithms on diagonal matrix
elements with nonzero imaginary part. (As the BLAS Standard specifies
and the Reference BLAS implements, the Hermitian algorithms do not
access the imaginary parts of diagonal elements, and assume they are
zero.) In our view, P3371 does not conflict with LWG4136.</p></li>
<li><p><a href="https://cplusplus.github.io/LWG/lwg-active.html#4137">LWG4137</a>,
“Fix Mandates, Preconditions, and Complexity elements of [linalg]
algorithms,” affects several sections touched by this proposal,
including [linalg.algs.blas3.rankk] and [linalg.algs.blas3.rank2k]. We
consider P3371 rebased atop the wording changes proposed by LWG4137.
While the wording changes may conflict in a formal (“diff”) sense, it is
our view that they do not conflict in a mathematical or specification
sense.</p></li>
</ul>
<h1 data-number="6" id="acknowledgments"><span class="header-section-number">6</span> Acknowledgments<a href="#acknowledgments" class="self-link"></a></h1>
<p>Many thanks (with permission) to Raffaele Solcà (CSCS Swiss National
Supercomputing Centre, <code>raffaele.solca@cscs.ch</code>) for pointing
out some of the issues fixed by this paper, as well as the issues
leading to LWG4137.</p>
<h1 data-number="7" id="wording"><span class="header-section-number">7</span> Wording<a href="#wording" class="self-link"></a></h1>
<blockquote>
<p>Text in blockquotes is not proposed wording, but rather instructions
for generating proposed wording. The � character is used to denote a
placeholder section number which the editor shall determine.</p>
<p>In <strong>[version.syn]</strong>, for the following definition,</p>
</blockquote>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define __cpp_lib_linalg </span>YYYYMML<span class="pp"> </span><span class="co">// also in &lt;linalg&gt;</span></span></code></pre></div>
<blockquote>
<p>adjust the placeholder value <code>YYYYMML</code> as needed so as to
denote this proposal’s date of adoption.</p>
</blockquote>
<h2 data-number="7.1" id="describe-how-functions-access-e"><span class="header-section-number">7.1</span> Describe how functions access
E<a href="#describe-how-functions-access-e" class="self-link"></a></h2>
<blockquote>
<p>Add the following lines just after the new line 1 of
[linalg.algs.blas3.rankk]. (These lines include the proposed fix from
LWG4136.)</p>
</blockquote>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span>
For any function <code>F</code> that takes a parameter named
<code>t</code>, an <code>InMat2</code> template parameter, and a
function parameter <code>InMat2 E</code>, <code>t</code> applies to
accesses done through the parameter <code>E</code>. <code>F</code> will
only access the triangle of <code>E</code> specified by <code>t</code>.
For accesses of diagonal elements <code>E[i, i]</code>, <code>F</code>
will use the value
<em><code>real-if-needed</code></em><code>(E[i, i])</code> if the name
of <code>F</code> starts with <code>hermitian</code>. For accesses
<code>E[i, j]</code> outside the triangle specified by <code>t</code>,
<code>F</code> will use the value</p>
<p><span class="marginalizedparent"><a class="marginalized">(2.1)</a></span>
<em><code>conj-if-needed</code></em><code>(E[j, i])</code> if the name
of <code>F</code> starts with <code>hermitian</code>, or</p>
<p><span class="marginalizedparent"><a class="marginalized">(2.2)</a></span>
<code>E[j, i]</code> if the name of <code>F</code> starts with
<code>symmetric</code>.</p>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span>
If <code>InMat2</code> has <code>layout_blas_packed</code> layout, then
the layout’s <code>Triangle</code> template argument has the same type
as the function’s <code>Triangle</code> template argument.</p>
<h2 data-number="7.2" id="new-exposition-only-concept-for-possibly-packed-output-matrices"><span class="header-section-number">7.2</span> New exposition-only concept for
possibly-packed output matrices<a href="#new-exposition-only-concept-for-possibly-packed-output-matrices" class="self-link"></a></h2>
<blockquote>
<p>In the header <code>&lt;linalg&gt;</code> synopsis
<strong>[linalg.syn]</strong>, immediately before the following,</p>
</blockquote>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">concept</span> <em>possibly-packed-inout-matrix</em> <span class="op">=</span> <em>see below</em>;   <span class="co">// exposition only</span></span></code></pre></div>
<blockquote>
<p>add the following.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">concept</span> <em>possibly-packed-out-matrix</em> <span class="op">=</span> <em>see below</em>;   <span class="co">// exposition only</span></span></code></pre></div>
<p>Then, to <strong>[linalg.helpers.concepts]</strong>, immediately
before the following,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">concept</span> <em>possibly-packed-inout-matrix</em> <span class="op">=</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    is<span class="op">-</span>mdspan<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> T<span class="op">::</span>rank<span class="op">()</span> <span class="op">==</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    is_assignable_v<span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">::</span>reference, <span class="kw">typename</span> T<span class="op">::</span>element_type<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>T<span class="op">::</span>is_always_unique<span class="op">()</span> <span class="op">||</span> is<span class="op">-</span>layout<span class="op">-</span>blas<span class="op">-</span>packed<span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">::</span>layout_type<span class="op">&gt;)</span>;</span></code></pre></div>
<blockquote>
<p>add the following definition of the exposition-only concept
<em><code>possibly-packed-out-matrix</code></em>.</p>
</blockquote>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">concept</span> <em>possibly-packed-out-matrix</em> <span class="op">=</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    is<span class="op">-</span>mdspan<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> T<span class="op">::</span>rank<span class="op">()</span> <span class="op">==</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    is_assignable_v<span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">::</span>reference, <span class="kw">typename</span> T<span class="op">::</span>element_type<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>T<span class="op">::</span>is_always_unique<span class="op">()</span> <span class="op">||</span> is<span class="op">-</span>layout<span class="op">-</span>blas<span class="op">-</span>packed<span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">::</span>layout_type<span class="op">&gt;)</span>;</span></code></pre></div>
<h2 data-number="7.3" id="new-exposition-only-concept-for-noncomplex-numbers"><span class="header-section-number">7.3</span> New exposition-only concept for
noncomplex numbers<a href="#new-exposition-only-concept-for-noncomplex-numbers" class="self-link"></a></h2>
<blockquote>
<p>In the Header <code>&lt;linalg&gt;</code> synopsis [linalg.syn], at
the end of the section started by the following comment:</p>
<p><code>// [linalg.helpers.concepts], linear algebra argument concepts</code>,</p>
<p>add the following declaration of the exposition-only concept
<em><code>noncomplex</code></em>.</p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">concept</span> _noncomplex_ <span class="op">=</span> <em>see below</em>; <span class="co">// exposition only</span></span></code></pre></div>
<blockquote>
<p>Append the following to [linalg.helpers.concepts].</p>
</blockquote>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">concept</span> _noncomplex_ <span class="op">=</span> <em>see below</em>;</span></code></pre></div>
<ol start="4" type="1">
<li>A type <code>T</code> models <em><code>noncomplex</code></em> if
<code>T</code> is a linear algebra value type, and either</li>
</ol>
<p>4.1) <code>T</code> is not an arithmetic type, or</p>
<p>4.2) the expression <code>conj(E)</code> is not valid, with overload
resolution performed in a context that includes the declaration
<code>template&lt;class T&gt; T conj(const T&amp;) = delete;</code>.</p>
<h2 data-number="7.4" id="constrain-scalar-alpha-in-hermitian-rank-1-and-rank-k-updates"><span class="header-section-number">7.4</span> Constrain Scalar alpha in
Hermitian rank-1 and rank-k updates<a href="#constrain-scalar-alpha-in-hermitian-rank-1-and-rank-k-updates" class="self-link"></a></h2>
<p>TODO</p>
<h2 data-number="7.5" id="rank-k-update-functions-in-synopsis"><span class="header-section-number">7.5</span> Rank-k update functions in
synopsis<a href="#rank-k-update-functions-in-synopsis" class="self-link"></a></h2>
<blockquote>
<p>In the header <code>&lt;linalg&gt;</code> synopsis
<strong>[linalg.syn]</strong>, change the following</p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// rank-k symmetric matrix update</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar, <em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span>Scalar alpha, InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy, <span class="kw">class</span> Scalar,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                                        Scalar alpha, InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span>InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix InMat</em>, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                                        InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// rank-k Hermitian matrix update</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar, <em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span>Scalar alpha, InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Scalar, <em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                                        Scalar alpha, InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span>InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat, <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>                                        InMat A, InOutMat C, Triangle t<span class="op">)</span>;</span></code></pre></div>
<blockquote>
<p>to read as follows.</p>
</blockquote>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwriting rank-k symmetric matrix update</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      Scalar alpha, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy, <span class="kw">class</span> Scalar,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, Scalar alpha, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// updating rank-k symmetric matrix update</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>      Scalar alpha,</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy, <span class="kw">class</span> Scalar,</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, Scalar alpha,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwriting rank-k Hermitian matrix update</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>      Scalar alpha, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy, <span class="kw">class</span> Scalar,</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, Scalar alpha, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>      InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat,</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, InMat A, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">// updating rank-k Hermitian matrix update</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>      Scalar alpha,</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy, <span class="kw">class</span> Scalar,</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec, Scalar alpha,</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1,</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat2,</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>           <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>      ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>      InMat1 A, InMat2 E, OutMat C, Triangle t<span class="op">)</span>;</span></code></pre></div>
<h2 data-number="7.6" id="rank-2k-update-functions-in-synopsis"><span class="header-section-number">7.6</span> Rank-2k update functions in
synopsis<a href="#rank-2k-update-functions-in-synopsis" class="self-link"></a></h2>
<blockquote>
<p>In the header <code>&lt;linalg&gt;</code> synopsis
<strong>[linalg.syn]</strong>, change the following</p>
</blockquote>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// rank-2k symmetric matrix update</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// rank-2k Hermitian matrix update</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, InOutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-inout-matrix</em> InOutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, InOutMat C, Triangle t<span class="op">)</span>;</span></code></pre></div>
<blockquote>
<p>to read as follows.</p>
</blockquote>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwriting rank-2k symmetric matrix update</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// updating rank-2k symmetric matrix update</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2, <em>in-matrix</em> InMat3,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, InMat3 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2, <em>in-matrix</em> InMat3,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, InMat3 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwriting rank-2k Hermitian matrix update</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// updating rank-2k Hermitian matrix update</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2, <em>in-matrix</em> InMat3,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>InMat1 A, InMat2 B, InMat3 E, OutMat C, Triangle t<span class="op">)</span>;</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>           <em>in-matrix</em> InMat1, <em>in-matrix</em> InMat2, <em>in-matrix</em> InMat3,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>           <em>possibly-packed-out-matrix</em> OutMat, <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span>ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>                                         InMat1 A, InMat2 B, InMat3 E, OutMat C, Triangle t<span class="op">)</span>;</span></code></pre></div>
<h2 data-number="7.7" id="specification-of-rank-k-update-functions"><span class="header-section-number">7.7</span> Specification of rank-k update
functions<a href="#specification-of-rank-k-update-functions" class="self-link"></a></h2>
<blockquote>
<p>Replace the entire contents of [linalg.algs.blas3.rankk] with the
following.</p>
</blockquote>
<p><i>[Note:</i> These functions correspond to the BLAS functions
<code>xSYRK</code> and <code>xHERK</code>. <i>– end note]</i></p>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span>
The following elements apply to all functions in
[linalg.algs.blas3.rankk].</p>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span>
<em>Mandates:</em></p>
<ul>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.1)</a></span> If
<code>OutMat</code> has <code>layout_blas_packed</code> layout, then the
layout’s <code>Triangle</code> template argument has the same type as
the function’s <code>Triangle</code> template argument.</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.2)</a></span>
<em><code>possibly-multipliable</code></em><code>&lt;decltype(A), decltype(transposed(A)), decltype(C)&gt;</code>
is <code>true</code>.</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.3)</a></span>
<em><code>possibly-addable</code></em><code>&lt;decltype(C), decltype(E), decltype(C)&gt;</code>
is <code>true</code> for those overloads that take an <code>E</code>
parameter.</p></li>
</ul>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span>
<em>Preconditions:</em></p>
<ul>
<li><p><span class="marginalizedparent"><a class="marginalized">(3.1)</a></span>
<em><code>multipliable</code></em><code>(A, transposed(A), C)</code> is
<code>true</code>. <i>[Note:</i> This implies that <code>C</code> is
square. <i>– end note]</i></p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(3.2)</a></span>
<em><code>addable</code></em><code>(C, E, C)</code> is <code>true</code>
for those overloads that take an <code>E</code> parameter.</p></li>
</ul>
<p><span class="marginalizedparent"><a class="marginalized">4</a></span>
<em>Complexity:</em> <span class="math inline"><em>O</em>(</span>
<code>A.extent(0)</code> <span class="math inline">⋅</span>
<code>A.extent(1)</code> <span class="math inline">⋅</span>
<code>A.extent(0)</code> <span class="math inline">)</span>.</p>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span>
<em>Remarks:</em> <code>C</code> may alias <code>E</code> for those
overloads that take an <code>E</code> parameter.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Scalar,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span>,
where the scalar <span class="math inline"><em>α</em></span> is
<code>alpha</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">6</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Scalar,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">7</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>,
where the scalar <span class="math inline"><em>α</em></span> is
<code>alpha</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  InMat A,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">8</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>A</em><em>A</em><sup><em>H</em></sup></span>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Scalar,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">9</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>α</em><em>A</em><em>A</em><sup><em>T</em></sup></span>,
where the scalar <span class="math inline"><em>α</em></span> is
<code>alpha</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">10</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>A</em><sup><em>T</em></sup></span>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Scalar,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Scalar,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  Scalar alpha,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">11</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>α</em><em>A</em><em>A</em><sup><em>H</em></sup></span>,
where the scalar <span class="math inline"><em>α</em></span> is
<code>alpha</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_k_update<span class="op">(</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  InMat2 E,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">12</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>A</em><sup><em>H</em></sup></span>.</p>
<h2 data-number="7.8" id="specification-of-rank-2k-update-functions"><span class="header-section-number">7.8</span> Specification of rank-2k update
functions<a href="#specification-of-rank-2k-update-functions" class="self-link"></a></h2>
<blockquote>
<p>Replace the entire contents of [linalg.algs.blas3.rank2k] with the
following.</p>
</blockquote>
<p><i>[Note:</i> These functions correspond to the BLAS functions
<code>xSYR2K</code> and <code>xHER2K</code>. <i>– end note]</i></p>
<p><span class="marginalizedparent"><a class="marginalized">1</a></span>
The following elements apply to all functions in
[linalg.algs.blas3.rank2k].</p>
<p><span class="marginalizedparent"><a class="marginalized">2</a></span>
<em>Mandates:</em></p>
<ul>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.1)</a></span> If
<code>OutMat</code> has <code>layout_blas_packed</code> layout, then the
layout’s <code>Triangle</code> template argument has the same type as
the function’s <code>Triangle</code> template argument;</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.2)</a></span>
<em><code>possibly-multipliable</code></em><code>&lt;decltype(A), decltype(transposed(B)), decltype(C)&gt;</code>
is <code>true</code>.</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.3)</a></span>
<em><code>possibly-multipliable</code></em><code>&lt;decltype(B), decltype(transposed(A)), decltype(C)&gt;</code>
is <code>true</code>.</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(2.4)</a></span>
<em><code>possibly-addable</code></em><code>&lt;decltype(C), decltype(E), decltype(C)&gt;</code>
is <code>true</code> for those overloads that take an <code>E</code>
parameter.</p></li>
</ul>
<p><span class="marginalizedparent"><a class="marginalized">3</a></span>
<em>Preconditions:</em></p>
<ul>
<li><p><span class="marginalizedparent"><a class="marginalized">(3.1)</a></span>
<em><code>multipliable</code></em><code>(A, transposed(B), C)</code> is
<code>true</code>.</p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(3.2)</a></span>
<em><code>multipliable</code></em><code>(B, transposed(A), C)</code> is
<code>true</code>. <i>[Note:</i> This and the previous imply that
<code>C</code> is square. <i>– end note]</i></p></li>
<li><p><span class="marginalizedparent"><a class="marginalized">(3.3)</a></span>
<em><code>addable</code></em><code>(C, E, C)</code> is <code>true</code>
for those overloads that take an <code>E</code> parameter.</p></li>
</ul>
<p><span class="marginalizedparent"><a class="marginalized">4</a></span>
<em>Complexity:</em> <span class="math inline"><em>O</em>(</span>
<code>A.extent(0)</code> <span class="math inline">⋅</span>
<code>A.extent(1)</code> <span class="math inline">⋅</span>
<code>B.extent(0)</code> <span class="math inline">)</span></p>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span>
<em>Remarks:</em> <code>C</code> may alias <code>E</code> for those
overloads that take an <code>E</code> parameter.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">5</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>A</em><em>B</em><sup><em>T</em></sup> + <em>B</em><em>A</em><sup><em>T</em></sup></span>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">6</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>A</em><em>B</em><sup><em>H</em></sup> + <em>B</em><em>A</em><sup><em>H</em></sup></span>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat3,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  InMat3 E,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat3,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> symmetric_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  InMat3 E,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">7</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>B</em><sup><em>T</em></sup> + <em>B</em><em>A</em><sup><em>T</em></sup></span>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><em>in-matrix</em> InMat1,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat3,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  InMat3 E,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> ExecutionPolicy,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat1,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat2,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>         <em>in-matrix</em> InMat3,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>         <em>possibly-packed-out-matrix</em> OutMat,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>         <span class="kw">class</span> Triangle<span class="op">&gt;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> hermitian_matrix_rank_2k_update<span class="op">(</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  ExecutionPolicy<span class="op">&amp;&amp;</span> exec,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  InMat1 A,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  InMat2 B,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  InMat3 E,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  OutMat C,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  Triangle t<span class="op">)</span>;</span></code></pre></div>
<p><span class="marginalizedparent"><a class="marginalized">8</a></span>
<em>Effects:</em> Computes <span class="math inline"><em>C</em> = <em>E</em> + <em>A</em><em>B</em><sup><em>H</em></sup> + <em>B</em><em>A</em><sup><em>H</em></sup></span>.</p>
</div>
</div>
</body>
</html>
